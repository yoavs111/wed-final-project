<!DOCTYPE html>
<html>
<head>
	<title>menu maneger</title>
	<script   src="https://code.jquery.com/jquery-2.2.4.js"   integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI="   crossorigin="anonymous"></script>
	<script src="http://code.jquery.com/jquery-1.12.0.min.js"></script>
	<script>

	</script>
	<style type="text/css">
		.sectionsLine{
			border-width: 3px;

		}
		input{
			margin: 5px 5px 5px 5px;
		}
		#menuTitle{
			border-bottom: 4px solid black;
			margin-bottom: 15px; 
		}
		.nameOfSection{
			border-bottom: 2px solid black;
			margin-bottom: 10px; 
		}
		textarea{
			margin: 5px 5px 5px 5px;
			width: 350px;
			height: 150px;
		}
		.item{
			display: table-caption;
		}
	</style>
</head>
<body>

	<div id="mainPage"></div>

	<script>
//model
var menuModel = null;

function getMenuData() {
	$.ajax('http://www.elm.tools/final/yoavs/menu', {
		success: function (data) {
    	console.log(data); //{title: 'dfgf', sections: []}
    	console.log('You have ', data.sections.length, 'sections');
    	menuModel = data;
    	render(menuModel);
    }
});
}


//controller functions
function saveChange (){
	var menuTitle = document.getElementById('menuTitle');
	menuModel.title =  menuTitle.value;
    updateMenuData(menuModel);
    var objSections = menuModel.sections;
    for (var i = 0; i < objSections.length; i++)
    {
    	var NameOfSection = document.getElementById(i);
    	objSections[i].name =  NameOfSection.value;
    }
}

function updateMenuData(menuModel) {
	$.ajax('http://www.elm.tools/final/yoavs/menu', {
		type: 'PUT',
		url: 'http://www.elm.tools/final/yoavs/menu',
		dataType: 'json',
		contentType: 'application/json',
		data: JSON.stringify(menuModel),
		success: function () {
			console.log('saved!');
		}
	});
}

// view
function render(menuModel) {
	var mainMenuPage = document.getElementById('mainPage');	
	//Menu Title
	var menuTitle = document.createElement('input');
	menuTitle.value = menuModel.title;
	menuTitle.id = "menuTitle";
	mainMenuPage.appendChild(menuTitle);
    //Sections
    var divSections = document.createElement('div');
    divSections.id = "sections";
    var objSections = menuModel.sections;
    for (var i = 0; i < objSections.length; i++) {
    	divSections.appendChild(renedrNameOfSection(i,objSections[i]));
    	divSections.appendChild(renderSection(i,objSections[i]));
    	var sectionsLine = document.createElement('hr');
    	sectionsLine.className = "sectionsLine";
    	divSections.appendChild(sectionsLine);
    	var brake = document.createElement('br');
    	divSections.appendChild(brake);
    }
    mainMenuPage.appendChild(divSections);

    var saveButton = document.createElement('button');
    saveButton.addEventListener('click', function () {
				saveChange ();
				});
    saveButton.textContent = 'save';
    mainMenuPage.appendChild(saveButton);
}

function renedrNameOfSection(i,objSections) {
	var nameOfSection = document.createElement('input');
	nameOfSection.value = objSections.name;
	nameOfSection.id = i;
	nameOfSection.className = "nameOfSection";
	return nameOfSection;
}

function renderSection(i,objSections) {
	var divSection = document.createElement('div');
	divSection.id = objSections.name;
	divSection.className = "Section";
	for (var j = 0 ; j < objSections.items.length; j++) {
		divSection.appendChild(renderItem(i,j,objSections.items[j]));
	}
	return divSection;
}

function renderItem(i,j,ObjItem) {
	var divItem = document.createElement('div');
	divItem.className = "item"; 
	var line = document.createElement('hr');

	//name
	var nameOfItem = document.createElement('input');
	nameOfItem.className = "nameOfItem";
	//nameOfItem.id = "i"+"j";?
	nameOfItem.value = ObjItem.name;

	//description
	var descriptionOfItem = document.createElement('textarea');
	descriptionOfItem.className = "descriptionOfItem";
	//descriptionOfItem.id = "i"+"j";?
	descriptionOfItem.value = "description: " + ObjItem.description + ".";

	//price
	var priceOfItem = document.createElement('input');
	priceOfItem.className = "priceOfItem";
	//priceOfItem.id = "i"+"j";?
	priceOfItem.value ="price: " + ObjItem.price;

	divItem.appendChild(nameOfItem);
	divItem.appendChild(descriptionOfItem);
	divItem.appendChild(priceOfItem);
	divItem.appendChild(line);
	return divItem;
}


getMenuData();
</script>
&nbsp;
</body>
</html>
